```{r setup2, include=FALSE}
library(here)
library(dataRetrieval)
library(tidyverse)
library(trend)
library(lubridate)
library(sf)
library(nhdplusTools)
library(mapview)
knitr::opts_chunk$set(echo = TRUE)
```


# Methods

Downloaded data from USGS site number 09014050 that is at the Grand lake outlet that was affected by the East Troublesome Fire.
Downloaded data from USGS site number 09034250 that is along troublesome creek and the Colorado river that was affected by the East Troublesome Fire.
Downloaded data from USGS site number 09040500 that is along the Colorado River that was affected by the East Troublesome Fire.


## USGS Sites

```{r}
site_no <- "09034250" 
site_no2 <- "09040500"
site_no3 <- "09014050"

control_site <- "09060799"
```

## Downloaded Discharge Data

```{r}

# Discharge data pulled form the site_no from 10/01/1986 to 1/1/2022
q <- readNWISdv(siteNumbers = site_no,
                parameterCd = '00060',
                startDate = '1986-10-01',
                endDate = '2022-01-01') %>%
  rename(q_cfs = X_00060_00003) %>%
  addWaterYear(.) %>%
  select(-agency_cd, -X_00060_00003_cd)

# site_no2
q2 <- readNWISdv(siteNumbers = site_no2,
                parameterCd = '00060',
                startDate = '1986-10-01',
                endDate = '2022-01-01') %>%
  rename(q_cfs = X_00060_00003) %>%
  addWaterYear(.) %>%
  select(-agency_cd, -X_00060_00003_cd)

# site_no3
q3 <- readNWISdv(siteNumbers = site_no3,
                parameterCd = '00060',
                startDate = '1986-10-01',
                endDate = '2022-01-01') %>%
  rename(q_cfs = X_00060_00003) %>%
  addWaterYear(.) %>%
  select(-agency_cd, -X_00060_00003_cd)

# control site
qC <- readNWISdv(siteNumbers = control_site,
                parameterCd = '00060',
                startDate = '1986-10-01',
                endDate = '2022-01-01') %>%
  rename(q_cfs = X_00060_00003) %>%
  addWaterYear(.) %>%
  select(-agency_cd, -X_00060_00003_cd)
```


### Mean Monthly Discharge site 09034250
```{r}
q_month_means <- q%>%
  mutate(month = month(Date),
         year = year(Date))%>%
  group_by(year, month)%>%
  summarize(q_mean = mean(q_cfs, na.rm=T))

```

### Min Monthly Discharge site 09034250
```{r}
q_month_mins <- q%>%
  mutate(month = month(Date),
         year = year(Date))%>%
  group_by(year, month)%>%
  summarize(q_min = min(q_cfs))

```

### Median Monthly Discharge site 09034250
```{r}
q_month_medians <- q%>%
  mutate(month = month(Date),
         year = year(Date))%>%
  group_by(year, month)%>%
  summarize(q_median = median(q_cfs))

```

## Specific Conductance Data

```{r}
# Specific conductance data pulled from the sites from 10/01/1986 to 1/1/2022

sc <- readNWISdv(siteNumbers = site_no,
                parameterCd = '00095',
                startDate = '1986-10-01', 
                endDate = '2021-09-30')%>%
  rename(sc_uscm = X_00095_00003)



sc2 <- readNWISdv(siteNumbers = site_no2,
                parameterCd = '00095',
                startDate = '1986-10-01', 
                endDate = '2021-09-30')%>%
  rename(sc_uscm = X_00095_00003)
 
#

alt3 <- readNWISdv(siteNumbers = site_no3,
                parameterCd = '00095', 
                startDate = '1986-10-01', 
                endDate = '2022-01-01')%>%
  rename(sc_uscm = X_00095_00003)
#
        

sc3 <- readNWISdv(siteNumbers = site_no3,
                parameterCd = '00095', 
                startDate = '1986-10-01', 
                endDate = '2022-01-01')%>%
  rename(sc_uscm = X_00095_00003)%>%
  addWaterYear(.) %>%
  select(-agency_cd, -X_00095_00003_cd)
```

### Joined Data

```{r}
allsc <- full_join(sc, sc2, alt3, by = c('Date','site_no', 'sc_uscm'))

w_sc <- spread(allsc, site_no, sc_uscm)
```

### Mean Monthly Data

```{r}
sc_month_means <- sc%>%
  mutate(month = month(Date),
         year = year(Date))%>%
  group_by(year, month)%>%
  summarize(sc_mean = mean(sc_uscm, na.rm=T))

sc2_month_means <- sc2%>%
  mutate(month = month(Date),
         year = year(Date))%>%
  group_by(year, month)%>%
  summarize(sc2_mean = mean(sc_uscm, na.rm=T))

sc3_month_means <- sc3%>%
  mutate(month = month(Date),
         year = year(Date))%>%
  group_by(year, month)%>%
  summarize(sc3_mean = mean(sc_uscm, na.rm=T))
```

### Min Monthly Data

```{r}
sc_month_min <- sc%>%
  mutate(month = month(Date),
         year = year(Date))%>%
  group_by(year, month)%>%
  summarize(sc_min = min(sc_uscm, na.rm=T))

sc2_month_min <- sc2%>%
  mutate(month = month(Date),
         year = year(Date))%>%
  group_by(year, month)%>%
  summarize(sc2_min = min(sc_uscm, na.rm=T))

sc3_month_min <- sc3%>%
  mutate(month = month(Date),
         year = year(Date))%>%
  group_by(year, month)%>%
  summarize(sc3_min = min(sc_uscm, na.rm=T))
```

### Median Monthly Data

```{r}
sc_month_median <- sc%>%
  mutate(month = month(Date),
         year = year(Date))%>%
  group_by(year, month)%>%
  summarize(sc_median = median(sc_uscm, na.rm=T))

sc2_month_median <- sc2%>%
  mutate(month = month(Date),
         year = year(Date))%>%
  group_by(year, month)%>%
  summarize(sc2_median = median(sc_uscm, na.rm=T))

sc3_month_median <- sc3%>%
  mutate(month = month(Date),
         year = year(Date))%>%
  group_by(year, month)%>%
  summarize(sc3_median = median(sc_uscm, na.rm=T))
```

## Turbidity 

```{r}
# site 1 daily turbidity 
T1 <- readNWISuv(siteNumbers = site_no,
                parameterCd = '63680')%>%
  mutate(dateTime = lubridate::as_datetime(dateTime),
         date = lubridate::as_date(dateTime))%>%
  group_by(site_no, date)%>%
  summarize(mean_T1 = mean(X_63680_00000))

write_csv(T1,'data/T1maddy.csv')

Turbidity_1 <- read_csv('data/T1maddy.csv')

# site 2 daily turbidity 
T2 <- readNWISuv(siteNumbers = site_no2,
                parameterCd = '63680')%>%
  mutate(dateTime = lubridate::as_datetime(dateTime),
         date = lubridate::as_date(dateTime))%>%
  group_by(site_no, date)%>%
  summarize(mean_T2 = mean(X_63680_00000))

write_csv(T2,'data/T2maddy.csv')

Turbidity_2 <- read_csv('data/T2maddy.csv')%>%
  rename( Date = date)

# site 3 daily turbidity
T3 <- readNWISuv(siteNumbers = site_no3,
                parameterCd = '63680')%>%
  mutate(dateTime = lubridate::as_datetime(dateTime),
         date = lubridate::as_date(dateTime))%>%
  group_by(site_no, date)%>%
  summarize(mean_T3 = mean(X_63680_00000))


write_csv(T3,'data/T3maddy.csv')

Turbidity_3 <- read_csv('data/T3maddy.csv')

# control site daily turbidity
TC <- readNWISuv(siteNumbers = control_site,
                parameterCd = '63680')%>%
  mutate(dateTime = lubridate::as_datetime(dateTime),
         date = lubridate::as_date(dateTime))%>%
  group_by(site_no, date)%>%
  summarize(mean_TC = mean(X_63680_00000))


write_csv(TC,'data/TCmaddy.csv')

Turbidity_C <- read_csv('data/T3maddy.csv')

```



## Site Discription

USGS 09014050 GRAND LAKE OUTLET BLW CHIPMUNK LN AT GRAND LK, CO
USGS site 09034250 COLORADO RIVER AT WINDY GAP, NEAR GRANBY, CO.
USGS 09040500 TROUBLESOME CREEK NEAR TROUBLESOME, CO.

### Deliniated Watershed
```{r}
watershed <- st_read('Granby.geojson')%>%
  dplyr::filter(id=='globalwatershed')

mapview(watershed)
```

